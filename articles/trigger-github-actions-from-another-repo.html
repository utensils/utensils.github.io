<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Home of the premier product studio"/><title>Trigger GitHub Actions from another repository | Utensils.io</title><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/401f026dd29a8793737d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/401f026dd29a8793737d.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6f4272a048091359c753.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6f4272a048091359c753.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-189c53927ffd3caf09c3.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-92300432a1172ef1338b.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-71948af4b0f09c0fc30e.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-752bd3b6185152c691e4.js" as="script"/><link rel="preload" href="/_next/static/chunks/996-fa0b52be06882e958afa.js" as="script"/><link rel="preload" href="/_next/static/chunks/522-4aeaaf1e0652afa03560.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/articles/%5Bslug%5D-b2cc46e2b6b28d024845.js" as="script"/></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5"><section class="flex-col flex items-left mt-20"><div class="flex-row flex items-left text-left"><a class="flex title-font font-medium items-center md:justify-start justify-center mr-4" href="/"><img src="/logo.png" class="w-12 h-12 mb-2"/></a><a href="/articles" class="pt-1 text-3xl text-red-500 hover:text-red-600 font-black hover:underline mr-4">Articles</a><a href="https://github.com/utensils" target="_blank" class="pt-1 text-3xl text-red-500 hover:text-red-600 font-black hover:underline">GitHub</a></div><div class="flex-col flex items-left mt-10"><h1 class="text-8xl font-black tracking-tighter leading-tight md:pr-8">Utensils</h1><span class="lowercase text-4xl text-gray-400">Trigger GitHub Actions from another repository</span></div></section><article><div class="max-w-2xl mx-right pl-6 pt-6"><div class="text-lg font-bold"><time dateTime="2021-06-13">June	13, 2021</time></div><div class="flex flex-inline pb-2 pt-4"><div class="flex items-center"><div class="text-2xl font-bold text-red-500 hover:text-red-600 pr-2"><a href="https://github.com/doomspork">Sean Callan</a></div></div></div></div><div class="max-w-2xl mx-right pl-6 prose"><span class="text-gray-400 text-bold text-xl">GitHub has no official support for trigger workflows across repos but that won&#x27;t stop us!</span><div class="markdown-styles_markdown__1x9gM"><p>As part of the new <a href="https://elixirischool.com">Elixir School</a> facelift we're splitting the Elixir Phoenix portion of the application out from the translated content.
In order to continue down the path of CI/CD we needed to identify a way to trigger the deployment in one repo based on merges in another.
We decided it was best to keep things inside GitHub Actions for now.</p>
<p>Out of the box GitHub does not provide an immediately obvious solution to this problem so after scouring the internet we were finally able to piece together a working solution which we'll document here today.</p>
<p>Before getting into the nuts and bolts let's review what we want to accomplish:</p>
<ol>
<li>For merges to <a href="https://github.com/elixirschool/school_house">school_house</a> deploy to Production. This exists today via the deploy.yml workflow.</li>
<li>Whenever changes are merged into the content repository, <a href="https://github.com/elixirschool/elixirschool">elixirschool</a>, trigger the aforementioned deployment.</li>
</ol>
<p>While GitHub may not provide a solution for this exact problem they do provide a robust API which has everything we'll need.
To achieve our goal we'll be relying on the <a href="https://github.blog/changelog/2020-07-06-github-actions-manual-triggers-with-workflow_dispatch/"><code>workflow_dispatch</code></a> event.</p>
<h2>Deployment Workflow</h2>
<p>Let's start by updating our existing deployment workflow to work with this new event.
Thanks to the flexibility of GitHub Actions we won't need to make many changes to our existing deploy script.
The minimal change we can make here is adding <code>workflow_dispatch</code> to the <code>on:</code> configuration for our Workflow.
This tells GitHub that for any <code>workflow_dispatch</code>, trigger this workflow, which is precisely what we need.</p>
<p>Let's update our <code>deploy.yml</code>:</p>
<pre><code class="language-yaml">name: Deploy

on:
  workflow_dispatch:
  push:
    branches:
      - master
</code></pre>
<p>Here we're telling GitHub for any <code>workflow_dispatch</code> and for pushes to <code>master</code> we want to trigger this workflow, our deployment.</p>
<h2>Personal Access Token</h2>
<p>Before we can trigger our <code>workflow_dispatch</code> even we'll need to generate a Personal Access Token to authenticate our request. Head over to the official GitHub document to see how to <a href="https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token">Create a personal access token</a>.</p>
<p>We'll need to add this new token to our repository (or organization) secrets. For this example we'll call our secret <code>ACCESS_TOKEN</code>.
With that in place we're ready to trigger the workflow</p>
<h2>External Repository Worflow</h2>
<p>We've updated our deployment workflow to listen to and trigger on the <code>workflow_dispatch</code> event and we've setup our personal access token so now it's time to tie it all together with a simple cURL request:</p>
<pre><code class="language-shell"> curl -X POST \
 -H "Authorization: Bearer ${{secrets.ACCESS_TOKEN}}" \
 -H "Accept: application/vnd.github.v3+json" \
 https://api.github.com/repos/&#x3C;YOUR ORG>/&#x3C;YOUR REPO>/actions/workflows/deploy.yml/dispatches \
 -d '{"ref": "master"}'
</code></pre>
<p>We make an HTTP to the <code>dispatches</code> endpoint of our workflow with our personal access token as the bearer token, the contents of the request body are not important here.
With a testing and working cURL command in place we need to create workflow file in our external repository to call it on merge:</p>
<pre><code class="language-yaml">---
name: Trigger Deploy

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - run: |
          curl -X POST \
          -H "Authorization: Bearer ${{secrets.ACCESS_TOKEN}}" \
          -H "Accept: application/vnd.github.v3+json" \
          https://api.github.com/repos/&#x3C;YOUR ORG>/&#x3C;YOUR REPO>/actions/workflows/deploy.yml/dispatches \
          -d '{"ref": "master"}'
</code></pre>
<p>That's it! When <code>master</code> is pushed to we'll fire off our cURL request which will in turn trigger our other repository's deployment worflow.</p>
</div></div></article></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"authors":[{"name":"Sean Callan","github":"https://github.com/doomspork"}],"content":"\u003cp\u003eAs part of the new \u003ca href=\"https://elixirischool.com\"\u003eElixir School\u003c/a\u003e facelift we're splitting the Elixir Phoenix portion of the application out from the translated content.\nIn order to continue down the path of CI/CD we needed to identify a way to trigger the deployment in one repo based on merges in another.\nWe decided it was best to keep things inside GitHub Actions for now.\u003c/p\u003e\n\u003cp\u003eOut of the box GitHub does not provide an immediately obvious solution to this problem so after scouring the internet we were finally able to piece together a working solution which we'll document here today.\u003c/p\u003e\n\u003cp\u003eBefore getting into the nuts and bolts let's review what we want to accomplish:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eFor merges to \u003ca href=\"https://github.com/elixirschool/school_house\"\u003eschool_house\u003c/a\u003e deploy to Production. This exists today via the deploy.yml workflow.\u003c/li\u003e\n\u003cli\u003eWhenever changes are merged into the content repository, \u003ca href=\"https://github.com/elixirschool/elixirschool\"\u003eelixirschool\u003c/a\u003e, trigger the aforementioned deployment.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eWhile GitHub may not provide a solution for this exact problem they do provide a robust API which has everything we'll need.\nTo achieve our goal we'll be relying on the \u003ca href=\"https://github.blog/changelog/2020-07-06-github-actions-manual-triggers-with-workflow_dispatch/\"\u003e\u003ccode\u003eworkflow_dispatch\u003c/code\u003e\u003c/a\u003e event.\u003c/p\u003e\n\u003ch2\u003eDeployment Workflow\u003c/h2\u003e\n\u003cp\u003eLet's start by updating our existing deployment workflow to work with this new event.\nThanks to the flexibility of GitHub Actions we won't need to make many changes to our existing deploy script.\nThe minimal change we can make here is adding \u003ccode\u003eworkflow_dispatch\u003c/code\u003e to the \u003ccode\u003eon:\u003c/code\u003e configuration for our Workflow.\nThis tells GitHub that for any \u003ccode\u003eworkflow_dispatch\u003c/code\u003e, trigger this workflow, which is precisely what we need.\u003c/p\u003e\n\u003cp\u003eLet's update our \u003ccode\u003edeploy.yml\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003ename: Deploy\n\non:\n  workflow_dispatch:\n  push:\n    branches:\n      - master\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere we're telling GitHub for any \u003ccode\u003eworkflow_dispatch\u003c/code\u003e and for pushes to \u003ccode\u003emaster\u003c/code\u003e we want to trigger this workflow, our deployment.\u003c/p\u003e\n\u003ch2\u003ePersonal Access Token\u003c/h2\u003e\n\u003cp\u003eBefore we can trigger our \u003ccode\u003eworkflow_dispatch\u003c/code\u003e even we'll need to generate a Personal Access Token to authenticate our request. Head over to the official GitHub document to see how to \u003ca href=\"https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token\"\u003eCreate a personal access token\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eWe'll need to add this new token to our repository (or organization) secrets. For this example we'll call our secret \u003ccode\u003eACCESS_TOKEN\u003c/code\u003e.\nWith that in place we're ready to trigger the workflow\u003c/p\u003e\n\u003ch2\u003eExternal Repository Worflow\u003c/h2\u003e\n\u003cp\u003eWe've updated our deployment workflow to listen to and trigger on the \u003ccode\u003eworkflow_dispatch\u003c/code\u003e event and we've setup our personal access token so now it's time to tie it all together with a simple cURL request:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003e curl -X POST \\\n -H \"Authorization: Bearer ${{secrets.ACCESS_TOKEN}}\" \\\n -H \"Accept: application/vnd.github.v3+json\" \\\n https://api.github.com/repos/\u0026#x3C;YOUR ORG\u003e/\u0026#x3C;YOUR REPO\u003e/actions/workflows/deploy.yml/dispatches \\\n -d '{\"ref\": \"master\"}'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe make an HTTP to the \u003ccode\u003edispatches\u003c/code\u003e endpoint of our workflow with our personal access token as the bearer token, the contents of the request body are not important here.\nWith a testing and working cURL command in place we need to create workflow file in our external repository to call it on merge:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e---\nname: Trigger Deploy\n\non:\n  push:\n    branches:\n      - master\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - run: |\n          curl -X POST \\\n          -H \"Authorization: Bearer ${{secrets.ACCESS_TOKEN}}\" \\\n          -H \"Accept: application/vnd.github.v3+json\" \\\n          https://api.github.com/repos/\u0026#x3C;YOUR ORG\u003e/\u0026#x3C;YOUR REPO\u003e/actions/workflows/deploy.yml/dispatches \\\n          -d '{\"ref\": \"master\"}'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThat's it! When \u003ccode\u003emaster\u003c/code\u003e is pushed to we'll fire off our cURL request which will in turn trigger our other repository's deployment worflow.\u003c/p\u003e\n","date":"2021-06-13","excerpt":"GitHub has no official support for trigger workflows across repos but that won't stop us!","slug":"trigger-github-actions-from-another-repo","title":"Trigger GitHub Actions from another repository"}},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"trigger-github-actions-from-another-repo"},"buildId":"VPbPdol2Jm2-cWdt78Stk","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-eef578260fd80f8fff94.js"></script><script src="/_next/static/chunks/webpack-189c53927ffd3caf09c3.js" async=""></script><script src="/_next/static/chunks/framework-92300432a1172ef1338b.js" async=""></script><script src="/_next/static/chunks/main-71948af4b0f09c0fc30e.js" async=""></script><script src="/_next/static/chunks/pages/_app-752bd3b6185152c691e4.js" async=""></script><script src="/_next/static/chunks/996-fa0b52be06882e958afa.js" async=""></script><script src="/_next/static/chunks/522-4aeaaf1e0652afa03560.js" async=""></script><script src="/_next/static/chunks/pages/articles/%5Bslug%5D-b2cc46e2b6b28d024845.js" async=""></script><script src="/_next/static/VPbPdol2Jm2-cWdt78Stk/_buildManifest.js" async=""></script><script src="/_next/static/VPbPdol2Jm2-cWdt78Stk/_ssgManifest.js" async=""></script></body></html>